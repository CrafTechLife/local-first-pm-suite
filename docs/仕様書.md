# WBS管理アプリ 仕様書

## 概要

共有フォルダを使用した、10人規模のチーム向けWBS（Work Breakdown Structure）管理Webアプリ。
既存のタスク管理アプリと同じ技術制約・設計思想のもと、プロジェクト全体の構造と進捗を可視化する。

---

## 背景・要件

### 課題
- 既存タスク管理アプリは日常の個別タスク管理には適しているが、プロジェクト全体の構造・進捗把握には不向き
- Excelでのガントチャート管理は更新が煩雑で、リアルタイム共有が難しい
- 外部ツール（MS Project、Asana等）は会社の制約で使用不可

### 制約条件
- 外部サービス利用不可
- Python環境なし
- HTML + JavaScriptのみで実装
- 共有フォルダは使用可能（SharePointをネットワークドライブとしてマウント可）
- ブラウザはChrome / Edge（IE、Firefox非対応）

### チーム規模
- 10人以内
- WBSの作成・更新は主にチームリードが担当

---

## 設計方針

### タスク管理アプリとの関係

| 観点 | タスク管理 | WBS管理 |
|------|-----------|---------|
| 構造 | フラット（個別タスクの集合） | 階層構造（プロジェクト→フェーズ→作業） |
| 時間軸 | 短期・日常的 | 中長期・プロジェクト全体 |
| 主な関心 | 「誰が何をやるか」 | 「全体のどこまで進んだか」 |
| 依存関係 | 基本的になし | 重要（先行・後続の関係） |
| 進捗管理 | 完了/未完了 | %単位の進捗 + 子要素からの集計 |

### ハイブリッドモデル（採用方針）

WBSとタスク管理の両方の良いところを取り入れた構造。

```
プロジェクト
├── [WBS] マイルストーン・成果物レベル（週〜月単位）
│   └── [タスク] 実作業レベル（時間〜日単位）※将来連携
│
└── [運用枠] 突発・継続作業用
    └── [タスク] 問い合わせ、顧客対応など
```

**WBSは「何を作るか」、タスクは「どう作るか」** という役割分担。

### WBSの粒度ガイドライン

| レベル | 粒度 | 例 |
|--------|------|-----|
| Level 1 | フェーズ | 設計、開発、テスト |
| Level 2 | 成果物/マイルストーン（3〜5日） | 要件定義書、API実装 |
| Level 3（任意） | サブ成果物 | 画面A、画面B |
| タスク | 1日以内の作業 | 「〇〇を実装」「レビュー」 |

### 突発作業の扱い

「運用・サポート」という特殊なWBS枠を設け、WBS計画外の作業（問い合わせ対応、顧客対応など）を管理する。

---

## アーキテクチャ

### フォルダ構成

```
共有フォルダ/
└── projects/                          ← WBS管理のルート
    └── project_ABC/                   ← プロジェクトごとのフォルダ
        ├── project.json               ← プロジェクト情報
        └── wbs/
            ├── wbs_1705123456789.json ← 各WBSノード（1ファイル1ノード）
            ├── wbs_1705123456790.json
            └── wbs_1705123456791.json
```

### 設計原則（タスク管理と共通）

- **1ノード1ファイル方式**: 同じWBSを同時編集しない限り競合しない
- **操作ごとに即時保存**: 保存ボタン不要
- **60秒ごとの自動リロード**: 他メンバーの変更を反映

### 技術仕様

| 項目 | 仕様 |
|------|------|
| フロントエンド | HTML + CSS + JavaScript（ライブラリ不使用） |
| データ形式 | JSON（1WBSノード1ファイル） |
| ファイルアクセス | File System Access API |
| データ保存先 | 共有フォルダ（ローカルマウント） |
| 対応ブラウザ | Chrome / Edge（Chromium系） |
| 自動リロード | 60秒間隔 |

---

## データ構造

### プロジェクト情報（project.json）

```json
{
  "id": "project_ABC",
  "name": "新規システム開発",
  "description": "顧客向け新規システムの開発プロジェクト",
  "createdAt": "2024-01-15T10:00:00.000Z",
  "createdBy": "山田太郎"
}
```

### WBSノード（wbs_xxx.json）

```json
{
  "id": "wbs_1705123456789",
  "code": "1.1",
  "name": "要件定義",
  "type": "deliverable | support | buffer",
  "parentCode": "1",
  "level": 1,
  "assignee": "山田",
  "plannedStart": "2024-02-01",
  "plannedEnd": "2024-02-07",
  "actualStart": "2024-02-03",
  "actualEnd": null,
  "plannedEffort": 5,
  "actualEffort": 3,
  "progress": 60,
  "progressCalcMethod": "manual | taskBased",
  "status": "not-started | in-progress | completed | on-hold",
  "milestone": false,
  "dependencies": ["1"],
  "note": "備考メモ",
  "createdAt": "2024-01-15T10:00:00.000Z",
  "createdBy": "山田太郎",
  "updatedAt": "2024-01-16T14:30:00.000Z",
  "updatedBy": "佐藤花子"
}
```

### フィールド説明

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| id | string | ○ | 一意識別子（wbs_タイムスタンプ） |
| code | string | ○ | WBSコード（例: "1.1.2"） |
| name | string | ○ | WBS名称 |
| type | enum | ○ | 種別: deliverable（成果物）, support（運用）, buffer（バッファ） |
| parentCode | string | - | 親WBSのコード（nullなら最上位） |
| level | number | ○ | 階層レベル（0始まり） |
| assignee | string | - | 担当者名 |
| plannedStart | date | - | 予定開始日（YYYY-MM-DD） |
| plannedEnd | date | - | 予定終了日（YYYY-MM-DD） |
| actualStart | date | - | 実績開始日 |
| actualEnd | date | - | 実績終了日 |
| plannedEffort | number | - | 予定工数（人日） |
| actualEffort | number | - | 実績工数（人日） |
| progress | number | ○ | 進捗率（0-100） |
| progressCalcMethod | enum | ○ | 進捗計算方法: manual（手動）, taskBased（タスク連携） |
| status | enum | ○ | ステータス |
| milestone | boolean | ○ | マイルストーンフラグ |
| dependencies | array | - | 先行WBSコードの配列 |
| note | string | - | メモ |
| createdAt | datetime | ○ | 作成日時（ISO 8601） |
| createdBy | string | ○ | 作成者 |
| updatedAt | datetime | ○ | 更新日時（ISO 8601） |
| updatedBy | string | ○ | 更新者 |

### WBS種別（type）の用途

| 種別 | 用途 | 進捗計算 |
|------|------|----------|
| deliverable | 通常の成果物・作業 | 通常通り集計 |
| support | 運用・問い合わせ対応など突発作業 | 工数のみ記録（進捗集計から除外可） |
| buffer | リスク吸収用の予備期間 | 消費率として管理 |

---

## 機能一覧

### Phase 1: WBS管理基盤（MVP）

#### WBSツリー表示・編集
- [x] 階層構造をインデント表示
- [x] 展開/折畳み（個別・全展開・全折畳み）
- [x] WBS追加・編集・削除
- [x] WBSコード自動採番
- [x] 種別（成果物/運用/バッファ）の色分け
- [x] マイルストーン表示（◆アイコン）
- [x] 右クリックコンテキストメニュー（編集・子追加・複製・削除）

#### 依存関係
- [x] 先行WBSの設定（複数選択可）
- [x] 依存関係の一覧表示（→コード形式）

#### 進捗管理
- [x] 手動での進捗率入力（0-100%）
- [x] ステータス管理（未着手/進行中/完了/保留）
- [x] 進捗に応じたステータス自動更新

#### ガントチャート（簡易版）
- [x] 日付ベースの横棒表示
- [x] 種別ごとの色分け
- [x] 進捗率のオーバーレイ表示
- [x] マイルストーンの菱形表示
- [x] 今日の日付ハイライト
- [x] 週末の背景色変更

#### サマリー表示
- [x] 全体進捗率（工数加重平均）
- [x] WBS項目数
- [x] 遅延項目数
- [x] 完了項目数

#### プロジェクト管理
- [x] 複数プロジェクト対応
- [x] プロジェクト切り替え
- [x] 新規プロジェクト作成

#### 共通機能
- [x] ユーザー名設定（localStorage保存）
- [x] 作成者・更新者の記録
- [x] 60秒ごとの自動リロード
- [x] 手動リロードボタン
- [x] 接続ステータス表示
- [x] トースト通知

### Phase 2: タスク連携（将来実装）

| 機能 | 説明 |
|------|------|
| タスクのWBS紐付け | 既存タスク管理にwbsCodeフィールド追加 |
| WBSからタスク一覧表示 | 紐づくタスクをWBS詳細に表示 |
| 進捗自動計算 | タスク完了率からWBS進捗を自動集計 |
| タスク作成ショートカット | WBSからタスクを直接作成 |

### Phase 3: 可視化強化（将来実装）

| 機能 | 説明 |
|------|------|
| 依存関係線 | ガントチャート上に矢印で依存関係を表示 |
| クリティカルパス | 遅延リスクのある経路をハイライト |
| ダッシュボード強化 | 担当者別進捗、フェーズ別進捗 |
| レポート出力 | 週次進捗サマリーのHTML/Excel出力 |
| EVM指標 | PV/EV/ACの計算・グラフ表示 |
| ベースライン管理 | 計画変更の履歴保持・比較 |

---

## UI仕様

### 画面構成

```
┌─────────────────────────────────────────────────────────────────┐
│ [ロゴ] WBS Manager    [プロジェクト選択▼][+新規]  [状態] [ユーザー名] │
├────────────┬────────────────────────────────────────────────────┤
│            │ [+ WBS追加] [+ 運用枠追加]        [全展開] [全折畳] │
│  サマリー   ├────────────────────────────────────────────────────┤
│  ┌──┬──┐  │ WBS名          │担当│状態  │期間      │進捗│依存│   │
│  │45%│12│  │ ▼ 1. 設計      │    │      │          │    │    │   │
│  │進捗│項目│  │   1.1 要件定義 │山田│進行中│2/1-2/7  │60% │    │   │
│  └──┴──┘  │   1.2 基本設計 │佐藤│未着手│2/8-2/21 │0%  │→1.1│   │
│  ┌──┬──┐  │ ▼ 2. 開発      │    │      │          │    │    │   │
│  │ 2│ 8│  │   ...          │    │      │          │    │    │   │
│  │遅延│完了│  │ ★ 運用        │    │      │          │    │    │   │
│  └──┴──┘  │   問い合わせ   │鈴木│      │2/5      │完了│    │   │
│            │                │    │      │          │    │    │   │
│ [ツリー]   │                │    │      │          │    │    │   │
│ [ガント]   │                │    │      │          │    │    │   │
│            │                │    │      │          │    │    │   │
│  凡例      │                │    │      │          │    │    │   │
│  ■成果物   │                │    │      │          │    │    │   │
│  ■運用     │                │    │      │          │    │    │   │
│  ■バッファ │                │    │      │          │    │    │   │
│  ◆MS      │                │    │      │          │    │    │   │
└────────────┴────────────────────────────────────────────────────┘
```

### 色設計

| 要素 | カラーコード | 用途 |
|------|-------------|------|
| 背景（メイン） | #0f1419 | アプリ全体の背景 |
| 背景（カード） | #1a2332 | サイドバー、ヘッダー |
| 背景（入力） | #243044 | フォーム、ボタン |
| テキスト（主） | #e7edf4 | 本文 |
| テキスト（副） | #8899a6 | ラベル、補足 |
| アクセント（青） | #1d9bf0 | 成果物、プライマリボタン |
| アクセント（緑） | #00ba7c | 完了、進捗 |
| アクセント（橙） | #ff7a00 | 運用・サポート |
| アクセント（紫） | #7856ff | バッファ |
| アクセント（黄） | #ffd400 | マイルストーン |
| アクセント（赤） | #f4212e | 遅延、エラー |

### ステータス表示

| ステータス | 表示 | 背景色 |
|-----------|------|--------|
| not-started | 未着手 | グレー半透明 |
| in-progress | 進行中 | 青半透明 |
| completed | 完了 | 緑半透明 |
| on-hold | 保留 | 橙半透明 |

---

## 進捗計算ロジック

### 手動入力（progressCalcMethod: manual）

ユーザーが直接0-100%を入力。

### タスクベース（progressCalcMethod: taskBased）※将来実装

```
WBSノードの進捗 = 配下タスクの加重平均

例：WBS「1.1 要件定義」
├── タスクA（見積2日）完了 → 100%
├── タスクB（見積1日）進行中 → 50%
└── タスクC（見積1日）未着手 → 0%

進捗 = (2×100% + 1×50% + 1×0%) / (2+1+1) = 62.5%
```

### 全体進捗（サマリー表示）

```
全体進捗 = Σ(各WBSの工数 × 各WBSの進捗) / Σ(各WBSの工数)

※工数未設定のWBSは1として計算
※type: support のWBSは集計対象に含める（除外オプションは将来検討）
```

---

## 操作フロー

### 初期セットアップ

1. 共有フォルダにプロジェクト用の空フォルダを作成
2. HTMLファイルをローカルに保存
3. Chrome/Edgeで開く
4. ユーザー名を入力
5. 「プロジェクトフォルダを開く」でフォルダ選択
6. 「+ 新規」でプロジェクト作成

### 日常の使い方

1. HTMLをブラウザで開く
2. プロジェクトを選択
3. WBS追加・編集（自動保存）
4. 60秒ごとに他メンバーの変更が反映

### WBS追加の流れ

1. 「+ WBS追加」ボタンをクリック
2. WBSコード（自動採番あり）、名称を入力
3. 種別を選択（成果物/運用/バッファ）
4. 必要に応じて親WBS、担当者、期間、依存関係を設定
5. 「保存」で即時反映

---

## 既存タスク管理アプリとの連携方針（Phase 2）

### タスク側の変更

既存タスクJSONに以下のフィールドを追加：

```json
{
  "id": "task_xxx",
  "projectId": "project_ABC",
  "wbsCode": "1.1",
  // ...既存フィールド
}
```

| フィールド | 型 | 説明 |
|-----------|-----|------|
| projectId | string | 所属プロジェクトID（null可） |
| wbsCode | string | 紐づくWBSコード（null可：WBS未紐付けタスク） |

### 連携動作

- WBS画面から紐づくタスク一覧を表示
- タスク完了率からWBS進捗を自動計算（progressCalcMethod: taskBased）
- WBS未紐付けタスク（wbsCode: null）も許容し、柔軟な運用を可能に

---

## 技術的な限界（HTML+JSの制約）

| できないこと | 理由 |
|-------------|------|
| リアルタイム同期 | WebSocketサーバーが必要 |
| ファイル変更の即時検知 | ファイル監視APIがブラウザにない |
| 認証・権限管理 | サーバーサイドが必要 |
| 自動バックアップ | スケジュール実行不可 |
| メール/Teams通知 | 外部API連携が必要 |
| 同時編集のマージ | CRDT等の実装が複雑 |

### 運用でカバーすべき点

- 同じWBSを同時編集しない（声かけ or チャット連絡）
- 定期的に手動バックアップ（フォルダごとコピー）
- ブラウザを閉じる前に編集完了確認

---

## 参考：タスク管理アプリとの機能比較

| 機能 | タスク管理 | WBS管理 |
|------|-----------|---------|
| データ単位 | タスク | WBSノード |
| 階層構造 | なし（フラット） | あり（親子関係） |
| 進捗管理 | 完了/未完了 | 0-100% |
| 依存関係 | なし | あり |
| ガントチャート | なし | あり |
| 複数リンク | あり | なし（将来検討） |
| カテゴリ | あり | 種別（type）で代替 |
| 優先度 | あり | なし（依存関係で管理） |

---

## バージョン履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| v1.0 | 2024-XX-XX | 初期リリース（Phase 1機能） |

---

## 改善リクエスト・フィードバック

（使用後のフィードバックを記録）

- 
- 
-