# WBS管理アプリ 仕様書 v2.0

## 概要

共有フォルダを使用した、10人規模のチーム向けWBS（Work Breakdown Structure）管理Webアプリ。
既存のタスク管理アプリと同じ技術制約・設計思想のもと、プロジェクト全体の構造と進捗を可視化する。

---

## 凡例（実装ステータス）

| マーク | 意味 |
|--------|------|
| ✅ | 実装済み |
| 🔲 | 未実装（Phase 1.5: 今回追加予定） |
| 📋 | 未実装（Phase 2: タスク連携） |
| 🔮 | 未実装（Phase 3: 可視化強化） |

---

## 背景・要件

### 課題
- 既存タスク管理アプリは日常の個別タスク管理には適しているが、プロジェクト全体の構造・進捗把握には不向き
- Excelでのガントチャート管理は更新が煩雑で、リアルタイム共有が難しい
- 外部ツール（MS Project、Asana等）は会社の制約で使用不可

### 制約条件
- 外部サービス利用不可
- Python環境なし
- HTML + JavaScriptのみで実装
- 共有フォルダは使用可能（SharePointをネットワークドライブとしてマウント可）
- ブラウザはChrome / Edge（IE、Firefox非対応）

### チーム規模
- 10人以内
- WBSの作成・更新は主にチームリードが担当

---

## 設計方針

### タスク管理アプリとの関係

| 観点 | タスク管理 | WBS管理 |
|------|-----------|---------|
| 構造 | フラット（個別タスクの集合） | 階層構造（プロジェクト→フェーズ→作業） |
| 時間軸 | 短期・日常的 | 中長期・プロジェクト全体 |
| 主な関心 | 「誰が何をやるか」 | 「全体のどこまで進んだか」 |
| 依存関係 | 基本的になし | 重要（先行・後続の関係） |
| 進捗管理 | 完了/未完了 | %単位の進捗 + 子要素からの集計 |

### ハイブリッドモデル（採用方針）

WBSとタスク管理の両方の良いところを取り入れた構造。

```
プロジェクト
├── [WBS] マイルストーン・成果物レベル（週〜月単位）
│   └── [タスク] 実作業レベル（時間〜日単位）※将来連携
│
└── [運用枠] 突発・継続作業用
    └── [タスク] 問い合わせ、顧客対応など
```

**WBSは「何を作るか」、タスクは「どう作るか」** という役割分担。

### WBSの粒度ガイドライン

| レベル | 粒度 | 例 |
|--------|------|-----|
| Level 1 | フェーズ | 設計、開発、テスト |
| Level 2 | 成果物/マイルストーン（3〜5日） | 要件定義書、API実装 |
| Level 3（任意） | サブ成果物 | 画面A、画面B |
| タスク | 1日以内の作業 | 「〇〇を実装」「レビュー」 |

### 突発作業の扱い

「運用・サポート」という特殊なWBS枠を設け、WBS計画外の作業（問い合わせ対応、顧客対応など）を管理する。

---

## アーキテクチャ

### フォルダ構成

```
共有フォルダ/
└── projects/                          ← WBS管理のルート
    └── project_ABC/                   ← プロジェクトごとのフォルダ
        ├── project.json               ← プロジェクト情報（カテゴリ・メンバー含む）
        ├── wbs/
        │   ├── wbs_1705123456789.json ← 各WBSノード（1ファイル1ノード）
        │   └── ...
        └── milestones/                ← 🔲 マイルストーン専用フォルダ
            ├── ms_1705123456789.json
            └── ...
```

### 設計原則（タスク管理と共通）

- **1ノード1ファイル方式**: 同じWBSを同時編集しない限り競合しない
- **操作ごとに即時保存**: 保存ボタン不要
- **60秒ごとの自動リロード**: 他メンバーの変更を反映

### 技術仕様

| 項目 | 仕様 |
|------|------|
| フロントエンド | HTML + CSS + JavaScript（ライブラリ不使用） |
| データ形式 | JSON（1WBSノード1ファイル） |
| ファイルアクセス | File System Access API |
| データ保存先 | 共有フォルダ（ローカルマウント） |
| 対応ブラウザ | Chrome / Edge（Chromium系） |
| 自動リロード | 60秒間隔 |

---

## データ構造

### プロジェクト情報（project.json）

```json
{
  "id": "project_ABC",
  "name": "新規システム開発",
  "description": "顧客向け新規システムの開発プロジェクト",
  "categories": [
    { "id": "cat_1705000001", "name": "設計", "color": "#1d9bf0" },
    { "id": "cat_1705000002", "name": "開発", "color": "#00ba7c" },
    { "id": "cat_1705000003", "name": "テスト", "color": "#7856ff" }
  ],
  "members": [
    { "id": "mem_1705000001", "name": "山田太郎", "role": "リーダー", "initials": "山田" },
    { "id": "mem_1705000002", "name": "佐藤花子", "role": "開発", "initials": "佐藤" }
  ],
  "createdAt": "2024-01-15T10:00:00.000Z",
  "createdBy": "山田太郎"
}
```

| フィールド | 型 | 必須 | 状態 | 説明 |
|-----------|-----|------|------|------|
| id | string | ○ | ✅ | プロジェクトID（フォルダ名） |
| name | string | ○ | ✅ | プロジェクト名 |
| description | string | - | ✅ | プロジェクト概要 |
| categories | array | - | 🔲 | カテゴリ定義の配列 |
| members | array | - | 🔲 | メンバー定義の配列 |
| createdAt | datetime | ○ | ✅ | 作成日時 |
| createdBy | string | ○ | ✅ | 作成者 |

#### カテゴリ定義 🔲

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | string | カテゴリID（cat_ + タイムスタンプ） |
| name | string | カテゴリ名 |
| color | string | 表示色（HEXカラーコード） |

#### メンバー定義 🔲

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | string | メンバーID（mem_ + タイムスタンプ） |
| name | string | 氏名 |
| role | string | 役割（任意） |
| initials | string | 短縮表示名（ガントチャート等で使用） |

---

### WBSノード（wbs_xxx.json）

```json
{
  "id": "wbs_1705123456789",
  "code": "1.1",
  "name": "要件定義",
  "type": "deliverable",
  "categoryId": "cat_1705000001",
  "parentCode": "1",
  "level": 1,
  "assignee": "山田",
  "assigneeIds": ["mem_1705000001"],
  "plannedStart": "2024-02-01",
  "plannedEnd": "2024-02-07",
  "actualStart": "2024-02-03",
  "actualEnd": null,
  "plannedEffort": 5,
  "actualEffort": 3,
  "progress": 60,
  "progressCalcMethod": "manual",
  "status": "on-track",
  "statusNote": "",
  "milestone": false,
  "dependencies": ["1"],
  "note": "備考メモ",
  "createdAt": "2024-01-15T10:00:00.000Z",
  "createdBy": "山田太郎",
  "updatedAt": "2024-01-16T14:30:00.000Z",
  "updatedBy": "佐藤花子"
}
```

| フィールド | 型 | 必須 | 状態 | 説明 |
|-----------|-----|------|------|------|
| id | string | ○ | ✅ | 一意識別子（wbs_タイムスタンプ） |
| code | string | ○ | ✅ | WBSコード（例: "1.1.2"） |
| name | string | ○ | ✅ | WBS名称 |
| type | enum | ○ | ✅ | 種別: deliverable / support / buffer |
| categoryId | string | - | 🔲 | カテゴリID（project.jsonのcategoriesを参照） |
| parentCode | string | - | ✅ | 親WBSのコード（nullなら最上位） |
| level | number | ○ | ✅ | 階層レベル（0始まり） |
| assignee | string | - | ✅ | 担当者名（後方互換用） |
| assigneeIds | array | - | 🔲 | 担当者ID配列（複数選択対応） |
| plannedStart | date | - | ✅ | 予定開始日（YYYY-MM-DD） |
| plannedEnd | date | - | ✅ | 予定終了日（YYYY-MM-DD） |
| actualStart | date | - | ✅ | 実績開始日 |
| actualEnd | date | - | ✅ | 実績終了日 |
| plannedEffort | number | - | ✅ | 予定工数（人日） |
| actualEffort | number | - | ✅ | 実績工数（人日） |
| progress | number | ○ | ✅ | 進捗率（0-100） |
| progressCalcMethod | enum | ○ | ✅ | 進捗計算: manual / taskBased |
| status | enum | ○ | 🔲拡張 | ステータス（6段階に拡張） |
| statusNote | string | - | 🔲 | ステータス補足説明 |
| milestone | boolean | ○ | ✅ | マイルストーンフラグ（将来は別管理へ移行） |
| dependencies | array | - | ✅ | 先行WBSコードの配列 |
| note | string | - | ✅ | メモ |
| createdAt | datetime | ○ | ✅ | 作成日時 |
| createdBy | string | ○ | ✅ | 作成者 |
| updatedAt | datetime | ○ | ✅ | 更新日時 |
| updatedBy | string | ○ | ✅ | 更新者 |

### WBS種別（type）の用途

| 種別 | 用途 | 進捗計算 |
|------|------|----------|
| deliverable | 通常の成果物・作業 | 通常通り集計 |
| support | 運用・問い合わせ対応など突発作業 | 工数のみ記録（進捗集計から除外可） |
| buffer | リスク吸収用の予備期間 | 消費率として管理 |

---

### マイルストーン（ms_xxx.json）🔲

WBS項目とは別に、マイルストーンを専用ファイルで管理。

```json
{
  "id": "ms_1705123456789",
  "name": "要件定義完了",
  "date": "2024-02-15",
  "categoryId": "cat_1705000001",
  "emoji": "🎯",
  "description": "顧客承認を得る",
  "linkedWbsCodes": ["1.1", "1.2"],
  "status": "not-started",
  "createdAt": "2024-01-15T10:00:00.000Z",
  "createdBy": "山田太郎",
  "updatedAt": "2024-01-16T14:30:00.000Z",
  "updatedBy": "佐藤花子"
}
```

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| id | string | ○ | マイルストーンID（ms_ + タイムスタンプ） |
| name | string | ○ | マイルストーン名 |
| date | date | ○ | 期日（YYYY-MM-DD） |
| categoryId | string | - | カテゴリID |
| emoji | string | - | 絵文字アイコン |
| description | string | - | 説明・備考 |
| linkedWbsCodes | array | - | 関連WBSコードの配列 |
| status | enum | ○ | not-started / completed |
| createdAt | datetime | ○ | 作成日時 |
| createdBy | string | ○ | 作成者 |
| updatedAt | datetime | ○ | 更新日時 |
| updatedBy | string | ○ | 更新者 |

---

### ステータス定義 🔲拡張

現行4段階から6段階に拡張し、進行中のリスクを可視化。

| ステータス | 表示 | 色 | 説明 | 状態 |
|-----------|------|-----|------|------|
| not-started | 未着手 | グレー | まだ開始していない | ✅ |
| on-track | 順調 | 青 | 予定通り進行中 | 🔲 |
| at-risk | 注意 | 黄 | 遅延の兆候あり | 🔲 |
| delayed | 遅延 | 赤 | 予定より遅れている | 🔲 |
| on-hold | 保留 | 橙 | 一時停止中 | ✅ |
| completed | 完了 | 緑 | 終了 | ✅ |

**移行ルール**
- 既存の `in-progress` → `on-track` に自動変換

**自動ステータス提案（オプション）**
- 進捗0% → not-started
- 進捗100% → completed
- 予定終了日 < 今日 かつ 進捗 < 100% → delayed を提案

---

## 機能一覧

### Phase 1: WBS管理基盤（MVP）✅ 実装済み

#### WBSツリー表示・編集
- ✅ 階層構造をインデント表示
- ✅ 展開/折畳み（個別・全展開・全折畳み）
- ✅ WBS追加・編集・削除
- ✅ WBSコード自動採番
- ✅ 種別（成果物/運用/バッファ）の色分け
- ✅ マイルストーン表示（◆アイコン）
- ✅ 右クリックコンテキストメニュー（編集・子追加・複製・削除）

#### 依存関係
- ✅ 先行WBSの設定（複数選択可）
- ✅ 依存関係の一覧表示（→コード形式）

#### 進捗管理
- ✅ 手動での進捗率入力（0-100%）
- ✅ ステータス管理（未着手/進行中/完了/保留）
- ✅ 進捗に応じたステータス自動更新

#### ガントチャート（簡易版）
- ✅ 日付ベースの横棒表示
- ✅ 種別ごとの色分け
- ✅ 進捗率のオーバーレイ表示
- ✅ マイルストーンの菱形表示
- ✅ 今日の日付ハイライト
- ✅ 週末の背景色変更

#### サマリー表示
- ✅ 全体進捗率（工数加重平均）
- ✅ WBS項目数
- ✅ 遅延項目数
- ✅ 完了項目数

#### プロジェクト管理
- ✅ 複数プロジェクト対応
- ✅ プロジェクト切り替え
- ✅ 新規プロジェクト作成

#### 共通機能
- ✅ ユーザー名設定（localStorage保存）
- ✅ 作成者・更新者の記録
- ✅ 60秒ごとの自動リロード
- ✅ 手動リロードボタン
- ✅ 接続ステータス表示
- ✅ トースト通知

---

### Phase 1.5: マスタ管理・機能拡張 🔲 未実装

#### カテゴリ管理 🔲
- 🔲 カテゴリ管理ダイアログ
- 🔲 カテゴリ追加（名前 + カラーピッカー）
- 🔲 カテゴリ編集・削除
- 🔲 カテゴリ一覧表示（色プレビュー付き）
- 🔲 WBS項目へのカテゴリ紐付け
- 🔲 カテゴリによるフィルタリング

#### メンバー管理 🔲
- 🔲 メンバー管理ダイアログ
- 🔲 メンバー追加（名前 + 役割 + 短縮名）
- 🔲 メンバー編集・削除
- 🔲 メンバー一覧表示
- 🔲 担当者選択のドロップダウン化
- 🔲 複数担当者選択対応

#### マイルストーン専用管理 🔲
- 🔲 マイルストーン管理ダイアログ/パネル
- 🔲 マイルストーン追加（名前、日付、カテゴリ、絵文字、関連WBS）
- 🔲 マイルストーン編集・削除
- 🔲 マイルストーン一覧表示（日付順）
- 🔲 絵文字選択UI
- 🔲 ガントチャート上に菱形＋絵文字で表示
- 🔲 既存WBSマイルストーンからの移行機能

#### ステータス拡張 🔲
- 🔲 6段階ステータス対応
- 🔲 ステータス補足説明（statusNote）
- 🔲 リスクステータスの色分け表示
- 🔲 自動ステータス提案機能

#### ガントチャート機能拡張 🔲
- 🔲 時間スケール切替（日/週/月）
- 🔲 水平ズーム（スライダー）
- 🔲 垂直ズーム（スライダー）
- 🔲 「今日へ移動」ボタン
- 🔲 「全体表示」ボタン

#### UI改善 🔲
- 🔲 設定メニュー追加（カテゴリ/メンバー/マイルストーン管理へのアクセス）
- 🔲 担当者別フィルタリング
- 🔲 カテゴリ別フィルタリング

---

### Phase 2: タスク連携 📋 未実装

| 機能 | 説明 | 状態 |
|------|------|------|
| タスクのWBS紐付け | 既存タスク管理にwbsCode/projectIdフィールド追加 | 📋 |
| WBSからタスク一覧表示 | 紐づくタスクをWBS詳細に表示 | 📋 |
| 進捗自動計算 | タスク完了率からWBS進捗を自動集計 | 📋 |
| タスク作成ショートカット | WBSからタスクを直接作成 | 📋 |

#### タスク側の変更（Phase 2）

既存タスクJSONに以下のフィールドを追加：

```json
{
  "id": "task_xxx",
  "projectId": "project_ABC",
  "wbsCode": "1.1"
}
```

---

### Phase 3: 可視化強化 🔮 未実装

| 機能 | 説明 | 状態 |
|------|------|------|
| 依存関係線 | ガントチャート上に矢印で依存関係を表示 | 🔮 |
| クリティカルパス | 遅延リスクのある経路をハイライト | 🔮 |
| ドラッグ＆ドロップ編集 | ガントチャート上でバーを移動して期間変更 | 🔮 |
| ダッシュボード強化 | 担当者別進捗、フェーズ別進捗 | 🔮 |
| レポート出力 | 週次進捗サマリーのHTML/Excel出力 | 🔮 |
| EVM指標 | PV/EV/ACの計算・グラフ表示 | 🔮 |
| ベースライン管理 | 計画変更の履歴保持・比較 | 🔮 |

---

## UI仕様

### 画面構成（Phase 1.5 対応版）

```
┌─────────────────────────────────────────────────────────────────────┐
│ [ロゴ] WBS Manager  [プロジェクト▼][+新規] [⚙設定▼] [状態] [ユーザー] │
├────────────┬────────────────────────────────────────────────────────┤
│            │ [+ WBS追加] [+ 運用枠追加]        [全展開] [全折畳]    │
│  サマリー   │ フィルタ: [担当者▼] [カテゴリ▼] [ステータス▼]         │
│  ┌──┬──┐  ├────────────────────────────────────────────────────────┤
│  │45%│12│  │ WBS名          │担当│状態  │期間      │進捗│依存│   │
│  │進捗│項目│  │ ▼ 1. 設計      │    │      │          │    │    │   │
│  └──┴──┘  │   1.1 要件定義 │山田│順調  │2/1-2/7  │60% │    │   │
│  ┌──┬──┐  │   1.2 基本設計 │佐藤│注意  │2/8-2/21 │30% │→1.1│   │
│  │ 2│ 8│  │ ▼ 2. 開発      │    │      │          │    │    │   │
│  │遅延│完了│  │   ...          │    │      │          │    │    │   │
│  └──┴──┘  │ ★ 運用        │    │      │          │    │    │   │
│            │   問い合わせ   │鈴木│      │2/5      │完了│    │   │
│ [ツリー]   │────────────────────────────────────────────────────────│
│ [ガント]   │ ガントチャートツールバー（🔲 Phase 1.5）               │
│            │ [日|週|月] 横幅:[===●===] 行高:[===●===] [今日] [全体] │
│  凡例      │                                                        │
│  ■成果物   │ ▼ガントチャート表示エリア                              │
│  ■運用     │   🎯要件定義完了(2/15)                                 │
│  ■バッファ │   ████████░░░░░░ 1.1 要件定義                          │
│  ◆MS      │        ████░░░░░░░░ 1.2 基本設計                       │
└────────────┴────────────────────────────────────────────────────────┘
```

### 設定メニュー（🔲 Phase 1.5）

```
[⚙ 設定▼]
 ├── カテゴリ管理
 ├── メンバー管理
 ├── マイルストーン管理
 └── 表示設定
```

### 色設計

| 要素 | カラーコード | 用途 |
|------|-------------|------|
| 背景（メイン） | #0f1419 | アプリ全体の背景 |
| 背景（カード） | #1a2332 | サイドバー、ヘッダー |
| 背景（入力） | #243044 | フォーム、ボタン |
| テキスト（主） | #e7edf4 | 本文 |
| テキスト（副） | #8899a6 | ラベル、補足 |
| アクセント（青） | #1d9bf0 | 成果物、順調、プライマリボタン |
| アクセント（緑） | #00ba7c | 完了、進捗 |
| アクセント（橙） | #ff7a00 | 運用・サポート、保留 |
| アクセント（紫） | #7856ff | バッファ |
| アクセント（黄） | #ffd400 | マイルストーン、注意 |
| アクセント（赤） | #f4212e | 遅延、エラー |

### ステータス表示

| ステータス | 表示 | 背景色 | 状態 |
|-----------|------|--------|------|
| not-started | 未着手 | グレー半透明 | ✅ |
| on-track | 順調 | 青半透明 | 🔲 |
| at-risk | 注意 | 黄半透明 | 🔲 |
| delayed | 遅延 | 赤半透明 | 🔲 |
| on-hold | 保留 | 橙半透明 | ✅ |
| completed | 完了 | 緑半透明 | ✅ |

---

## 進捗計算ロジック

### 手動入力（progressCalcMethod: manual）✅

ユーザーが直接0-100%を入力。

### タスクベース（progressCalcMethod: taskBased）📋

```
WBSノードの進捗 = 配下タスクの加重平均

例：WBS「1.1 要件定義」
├── タスクA（見積2日）完了 → 100%
├── タスクB（見積1日）進行中 → 50%
└── タスクC（見積1日）未着手 → 0%

進捗 = (2×100% + 1×50% + 1×0%) / (2+1+1) = 62.5%
```

### 全体進捗（サマリー表示）✅

```
全体進捗 = Σ(各WBSの工数 × 各WBSの進捗) / Σ(各WBSの工数)

※工数未設定のWBSは1として計算
※type: support のWBSは集計対象に含める（除外オプションは将来検討）
```

---

## 移行・互換性

既存データからの移行を考慮。

| 項目 | 対応 |
|------|------|
| assignee（文字列） | assigneeIds が空の場合、assignee を表示用に使用 |
| status: in-progress | on-track に自動変換 |
| milestone: true（WBS内） | 初回起動時にマイルストーンフォルダへ移行提案 |
| categoryId 未設定 | 「未分類」として表示 |
| categories 未定義 | 空配列として初期化 |
| members 未定義 | 空配列として初期化 |

---

## 操作フロー

### 初期セットアップ

1. 共有フォルダにプロジェクト用の空フォルダを作成
2. HTMLファイルをローカルに保存
3. Chrome/Edgeで開く
4. ユーザー名を入力
5. 「プロジェクトフォルダを開く」でフォルダ選択
6. 「+ 新規」でプロジェクト作成

### 日常の使い方

1. HTMLをブラウザで開く
2. プロジェクトを選択
3. WBS追加・編集（自動保存）
4. 60秒ごとに他メンバーの変更が反映

### WBS追加の流れ

1. 「+ WBS追加」ボタンをクリック
2. WBSコード（自動採番あり）、名称を入力
3. 種別を選択（成果物/運用/バッファ）
4. 必要に応じて親WBS、担当者、期間、依存関係、カテゴリを設定
5. 「保存」で即時反映

---

## 技術的な限界（HTML+JSの制約）

| できないこと | 理由 |
|-------------|------|
| リアルタイム同期 | WebSocketサーバーが必要 |
| ファイル変更の即時検知 | ファイル監視APIがブラウザにない |
| 認証・権限管理 | サーバーサイドが必要 |
| 自動バックアップ | スケジュール実行不可 |
| メール/Teams通知 | 外部API連携が必要 |
| 同時編集のマージ | CRDT等の実装が複雑 |

### 運用でカバーすべき点

- 同じWBSを同時編集しない（声かけ or チャット連絡）
- 定期的に手動バックアップ（フォルダごとコピー）
- ブラウザを閉じる前に編集完了確認

---

## 実装優先度（Phase 1.5）

| 優先度 | 機能 | 工数目安 |
|--------|------|----------|
| 高 | カテゴリ管理 | 0.5日 |
| 高 | メンバー管理 | 0.5日 |
| 高 | マイルストーン専用管理 | 1日 |
| 中 | ステータス6段階化 | 0.5日 |
| 中 | ガントチャートズーム | 1日 |
| 中 | フィルタリング機能 | 0.5日 |
| 低 | 設定メニューUI | 0.5日 |

---

## バージョン履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| v1.0 | 2024-XX-XX | 初期リリース（Phase 1機能） |
| v2.0 | 2026-XX-XX | Phase 1.5 機能追加（カテゴリ/メンバー/マイルストーン管理、ステータス拡張、ガントチャート機能拡張） |

---

## 改善リクエスト・フィードバック

（使用後のフィードバックを記録）

- 
- 
-