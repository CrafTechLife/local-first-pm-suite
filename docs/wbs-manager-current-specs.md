# WBS Manager 現在の仕様書
*(2026-01-18 時点)*

## 1. 概要
共有フォルダ（ローカルファイルシステム）を利用して、チームでWBS（Work Breakdown Structure）を管理するシングルページアプリケーション。
HTMLファイル単体で動作し、各WBS項目を個別のJSONファイルとして保存することで、簡易的な同時編集（競合回避）とデータ永続化を実現している。

## 2. 背景と設計思想
*(出典: docs/仕様書.md)*

### 2.1 開発背景
- **課題**: 既存のタスク管理アプリは日常の個別タスクには適しているが、プロジェクト全体の構造把握や中長期的なスケジュールの可視化（ガントチャート）が難しい。
- **制約**: 外部SaaS利用不可、Python等のサーバーサイド環境なし、Chrome/Edgeのみ利用可能。
- **解決策**: タスク管理とは別に、プロジェクト全体の「構造」と「進捗」を管理する専用ツールとして開発。

### 2.2 設計方針 (ハイブリッドモデル)
WBSとタスク管理を明確に役割分担させる。

- **WBS管理 (本アプリ)**: 「何を作るか」を管理。階層構造（プロジェクト→フェーズ→成果物）を持ち、週〜月単位の進捗を追う。
- **タスク管理 (既存)**: 「どう作るか」を管理。フラットな構造で、日単位の作業を追う。

### 2.3 WBSの粒度
- **Level 1 (フェーズ)**: 設計、開発、テストなど
- **Level 2 (成果物)**: 要件定義書、API実装など（3〜5日規模）
- **Level 3 (サブ成果物)**: 必要に応じて詳細化

## 3. システム構成・アーキテクチャ

### 3.1 動作環境
- **プラットフォーム**: モダンブラウザ（Chrome, Edge等）
- **依存技術**:
  - File System Access API (ローカル/共有フォルダへのアクセス)
  - Vanilla JS, CSS, HTML (フレームワークなし)
  - LocalStorage (ユーザー名、前回開いたプロジェクトの記憶)

### 3.2 フォルダ構成
アプリケーションが管理するルートフォルダ直下の構成：

```
[ルートフォルダ]/
 ├── [プロジェクトID]/
 │    ├── project.json       # プロジェクト基本情報
 │    └── wbs/               # WBSデータ格納フォルダ
 │         ├── wbs_[timestamp].json  # 各WBS項目のデータファイル
 │         └── ...
 └── ...
```

## 4. データ構造

### 4.1 プロジェクト情報 (project.json)
| フィールド | 型 | 説明 |
|---|---|---|
| `id` | string | ID（英数字・アンダースコア）。フォルダ名にもなる |
| `name` | string | プロジェクト名 |
| `description` | string | プロジェクト概要 |
| `createdAt` | ISOString | 作成日時 |
| `createdBy` | string | 作成者名 |

### 4.2 WBS項目 (wbs_*.json)
各WBSノードは個別のJSONファイルとして保存される。

| フィールド | 型 | 説明 |
|---|---|---|
| `id` | string | ユニークID (`wbs_` + タイムスタンプ) |
| `code` | string | WBSコード (例: "1.1", "1.1.2") |
| `name` | string | タスク/アイテム名称 |
| `type` | enum | `deliverable`(成果物), `support`(運用), `buffer`(バッファ) |
| `level` | number | インデントレベル (0開始) |
| `parentCode` | string | 親WBSのコード (ルートは null または "") |
| `assignee` | string | 担当者名 |
| `plannedStart` | date-string | 予定開始日 (YYYY-MM-DD) |
| `plannedEnd` | date-string | 予定終了日 (YYYY-MM-DD) |
| `plannedEffort` | number | 予定工数 (人日) |
| `progress` | number | 進捗率 (0-100) |
| `status` | enum | `not-started` (0%), `in-progress` (1-99%), `completed` (100%) |
| `milestone` | boolean | マイルストーンかどうか |
| `dependencies` | array | 先行タスクのコード配列 |
| `note` | string | メモ・備考 |
| `created/updated` | - | 作成・更新のユーザー名とタイムスタンプ |

## 5. 機能詳細 (Phase 1 実装済み)

### 5.1 プロジェクト管理
- **フォルダ選択**: `window.showDirectoryPicker` を使用してローカルフォルダへのアクセス権を取得。
- **新規作成**: ID、名前、説明を入力してフォルダ構造を生成。
- **切り替え**: ルートフォルダ内のサブフォルダをスキャンし、`project.json` があるものをリストアップして切り替え可能。

### 5.2 WBS編集
- **追加**:
  - 自動採番機能（親WBSを選択すると、その子としての次番を自動提案）。
  - 最上位アイテムの追加も可能。
- **編集**: 既存アイテムの内容を変更。
- **削除**: アイテムのJSONファイルを削除（論理削除でなく物理削除）。
- **複製**: 既存アイテムをコピーして新規作成（コードは自動で次番）。
- **コード変更時のカスケード更新**:
  - 親のコードを変更した場合や、自身のコードを変更した場合、配下の子要素および依存関係を持つ他アイテムの `parentCode` や `dependencies` を自動的に書き換えて再保存する機能。

### 5.3 ビュー機能
#### ツリービュー (Tree View)
- 階層構造の表示（インデント）。
- 折りたたみ/展開の状態管理（メモリ内）。
- ステータスによるバッジ表示。
- 遅延アラート（ステータス未完了かつ期日超過で赤字表示）。
- コンテキストメニュー（右クリック）による操作ショートカット。

#### ガントチャート (Gantt View)
- 期間が設定されているアイテムをバーとして描画。
- マイルストーンは菱形アイコンで特定表示。
- 種別（成果物/運用/バッファ）ごとの色分け。
- 進捗率に応じたバー内部の塗りつぶし。
- ※現時点では依存関係の線（矢印）は描画されない。

### 5.4 運用支援機能
- **自動リロード**: 60秒ごとにデータを再読み込みし、他者の更新を反映。
- **自動保存**: 「保存」ボタン押下時に即座にファイル書き込み。
- **サマリー表示**: 全体進捗（工数加重平均）、遅延数などをサイドバーに常時表示。
- **トースト通知**: 保存成功時やエラー時に画面右下に通知を表示。

## 6. UI/UX デザイン
- **テーマ**: ダークモード（#0f1419 ベース）。
- **カラーコード**:
  - 成果物: #1d9bf0 (青)
  - 運用: #ff7a00 (橙)
  - バッファ: #7856ff (紫)
  - 完了/進捗: #00ba7c (緑)
  - 遅延: #f4212e (赤)

## 7. 特記事項・計算ロジック
- **全体進捗計算**:
  - `Σ(各WBSの工数 × 進捗率) / Σ全工数`
  - 工数が未設定(0)の場合は便宜上「1」として計算される（コード実装に基づく）。
- **制限事項**:
  - ブラウザのセキュリティ制約により、リロードごとにフォルダのアクセス許可がリセットされる場合がある。
  - 同時編集の排他制御はファイル単位（OS/ファイルシステム依存）。

## 8. 将来のロードマップ (Phase 2 & 3)
*(出典: docs/仕様書.md - 未実装)*

### Phase 2: タスク連携
- 既存タスク管理アプリとの連携。
- タスク側に `wbsCode` を持たせ、WBS側で紐づくタスク一覧を表示。
- タスクの完了状況からWBSの進捗を自動計算 (`progressCalcMethod: taskBased`)。

### Phase 3: 可視化強化
- ガントチャート上での依存関係線（矢印）の描画。
- クリティカルパスのハイライト。
- EVM指標 (PV/EV/AC) の計算とグラフ表示。
